---
import Layout from '../layouts/Layout.astro';
import { getCollection } from 'astro:content';
import { getImageBaseUrl, getLinkUrl } from '../utils/images';

const galleries = await getCollection('gallery');
const sortedGalleries = galleries.sort((a, b) => {
  const dateA = a.data.date || new Date(0);
  const dateB = b.data.date || new Date(0);
  return dateB.getTime() - dateA.getTime();
});
---

<Layout
  title="Gallery | GMC Tourism"
  description="Explore our collection of images showcasing the beauty of Gelephu Mindfulness City and Bhutan."
  mainClass="pt-0"
>
  <!-- Hero Section -->
  <div class="relative h-[50vh] w-full overflow-hidden flex items-center justify-center">
    <img
      src={`${getImageBaseUrl()}/backgrounds/home-background.jpg`}
      alt="Gallery"
      class="absolute h-full w-full object-cover"
    />
    <div class="absolute inset-0 z-10 bg-linear-to-b from-black/50 via-black/30 to-black/60"></div>
    <div class="relative z-10 text-center px-4">
      <h1
        class="gallery-hero-title text-4xl font-bold text-white md:text-5xl lg:text-6xl drop-shadow-sm"
      >
        Gallery
      </h1>
      <p class="gallery-hero-subtitle mt-4 text-lg text-white md:text-xl drop-shadow-sm">
        Visual stories from the Kingdom of Happiness
      </p>
    </div>
    
    <!-- Bottom gradient fade -->
    <div
      class="absolute bottom-0 left-0 right-0 z-20 h-16"
      style="background: linear-gradient(to top, #000000, transparent);"
    >
    </div>
  </div>

  <!-- Gallery Grid -->
  <section class="py-16 px-4 sm:px-6 lg:px-8 text-white min-h-[50vh]">
    <div class="max-w-7xl mx-auto">
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
        {
          sortedGalleries.map((gallery) => (
            <a
              href={getLinkUrl(`/gallery/${gallery.slug}`)}
              class="gallery-item group relative block overflow-hidden rounded-xl bg-gray-900 aspect-4/3 transition-all duration-300 hover:scale-[1.02] hover:shadow-2xl"
            >
              <!-- Card Image -->
              <div class="relative h-full w-full overflow-hidden">
              <img
                src={`${getImageBaseUrl()}${gallery.data.coverImage}`}
                alt={gallery.data.title}
                  class="h-full w-full object-cover transition-transform duration-500 group-hover:scale-110"
                />
                
                <!-- Category Tag -->
                {gallery.data.description && (
                  <div class="absolute top-3 right-3 z-10">
                    <span class="gallery-category-tag liquid-glass-badge inline-block px-3 py-1 rounded-full text-xs font-medium text-white">
                      Gallery
                    </span>
                  </div>
                )}
              </div>

              <!-- Bottom Overlay with Text -->
              <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/95 via-black/80 to-transparent p-4">
                <div class="flex items-start justify-between gap-3">
                  <div class="flex-1 min-w-0">
                    <h2 class="gallery-card-title text-base font-semibold text-white mb-1 truncate">
                  {gallery.data.title}
                </h2>
                    <p class="gallery-card-text text-xs text-white/80 flex items-center gap-1.5">
                      <i class="fa-regular fa-images text-[10px]" />
                      <span>{gallery.data.images.length} file(s)</span>
                </p>
                  </div>
                  <!-- View Icon -->
                  <div class="gallery-icon liquid-glass-button flex-shrink-0 w-8 h-8 rounded-full flex items-center justify-center transition-all duration-300 group-hover:scale-110">
                    <i class="fa-solid fa-arrow-right text-white text-xs"></i>
                  </div>
                </div>
              </div>
            </a>
          ))
        }
      </div>

      {
        sortedGalleries.length === 0 && (
          <div class="text-center py-20">
            <p class="text-gray-400 text-lg">No galleries found.</p>
          </div>
        )
      }
    </div>
  </section>
</Layout>

<style>
  .gallery-hero-title {
    color: #ffffff !important;
  }

  .gallery-hero-subtitle {
    color: #ffffff !important;
  }

  :global([data-theme='light']) .gallery-hero-title,
  :global([data-theme='light']) .gallery-hero-subtitle {
    color: #ffffff !important;
  }

  :global([data-theme='light']) section {
    background-color: transparent;
    color: #0f172a;
  }

  :global([data-theme='light']) .group {
    background-color: #e2e8f0;
  }

  /* Gallery card text - keep white in both themes */
  .gallery-card-title,
  .gallery-card-text {
    color: #ffffff !important;
  }

  :global([data-theme='light']) .gallery-card-title,
  :global([data-theme='light']) .gallery-card-text {
    color: #ffffff !important;
  }

  .gallery-item {
    background-color: rgba(255, 255, 255, 0.05);
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
  }

  .gallery-item:hover {
    box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.3), 0 10px 10px -5px rgba(0, 0, 0, 0.2);
  }

  :global([data-theme='light']) .gallery-item {
    background-color: rgba(15, 23, 42, 0.05);
  }

  .liquid-glass-badge {
    background: rgba(107, 114, 128, 0.8);
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
    border: none;
    color: #ffffff !important;
  }

  :global([data-theme='dark']) .liquid-glass-badge,
  :global([data-theme='light']) .liquid-glass-badge {
    color: #ffffff !important;
  }

  .liquid-glass-button {
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(20px) saturate(180%);
    -webkit-backdrop-filter: blur(20px) saturate(180%);
    border: none;
    box-shadow: 
      0 4px 16px 0 rgba(0, 0, 0, 0.3),
      inset 0 1px 0 0 rgba(255, 255, 255, 0.3);
  }

  .liquid-glass-button:hover {
    background: rgba(255, 255, 255, 0.15);
    box-shadow: 
      0 6px 20px 0 rgba(0, 0, 0, 0.4),
      inset 0 1px 0 0 rgba(255, 255, 255, 0.4);
  }

  .liquid-glass-button i {
    color: #ffffff !important;
  }

  :global([data-theme='dark']) .liquid-glass-button i,
  :global([data-theme='light']) .liquid-glass-button i {
    color: #ffffff !important;
  }
</style>
