---
import { getCollection } from 'astro:content';
import Layout from '../../layouts/Layout.astro';

export async function getStaticPaths() {
	const posts = await getCollection('blog', ({ data }) => !data.draft);
	return posts.map((post) => ({
		params: { slug: post.slug },
		props: { post },
	}));
}

const { post } = Astro.props;
const { Content, headings } = await post.render();
const { data } = post;

const publishDate = new Date(data.publishDate);
const updatedDate = data.updatedDate ? new Date(data.updatedDate) : publishDate;

const structuredData = {
	'@context': 'https://schema.org',
	'@type': 'BlogPosting',
	headline: data.title,
	description: data.description,
	datePublished: publishDate.toISOString(),
	dateModified: updatedDate.toISOString(),
	image: data.heroImage,
};
---

<Layout
	title={data.title}
	description={data.description}
	ogImage={data.heroImage}
	structuredData={structuredData}
>
	<article class="mx-auto flex w-full max-w-4xl flex-col gap-10 px-6 py-24 lg:px-0">
		<header class="flex flex-col gap-6">
			<p class="text-sm font-medium uppercase tracking-[0.3em] text-slate-400">
				{publishDate.toLocaleDateString('en-US', {
					year: 'numeric',
					month: 'short',
					day: 'numeric',
				})}
			</p>
			<h1 class="text-4xl font-bold text-white sm:text-5xl">{data.title}</h1>
			<p class="max-w-2xl text-lg text-slate-300">{data.description}</p>
		</header>
		<div class="grid gap-8 lg:grid-cols-[minmax(0,3fr)_minmax(0,1fr)] lg:gap-16">
			<section class="markdown">
				<Content />
			</section>
			<aside class="hidden lg:flex lg:flex-col lg:gap-6">
				<div class="card sticky top-24 flex flex-col gap-4">
					<h2 class="text-sm font-semibold uppercase tracking-[0.3em] text-slate-200">
						On this page
					</h2>
					<nav class="flex flex-col gap-2 text-sm text-slate-400">
						{headings
							.filter(({ depth }) => depth === 2 || depth === 3)
							.map(({ text, slug }) => (
								<a
									href={`#${slug}`}
									class="rounded-md px-3 py-2 hover:bg-white/5 hover:text-slate-100"
								>
									{text}
								</a>
							))}
					</nav>
				</div>
			</aside>
		</div>
	</article>
</Layout>

