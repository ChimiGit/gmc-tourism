---
import { getImageBaseUrl } from '../../utils/images';
---

<section
  class="about-section relative min-h-screen w-full overflow-hidden"
  style="background-color: #000000;"
>
  <!-- Background Video -->
  <div class="absolute inset-0 h-full w-full overflow-hidden">
    <video
      id="about-video"
      class="absolute h-full w-full scale-110 object-cover object-center"
      autoplay
      muted
      loop
      playsinline
      preload="metadata"
      poster={`${getImageBaseUrl()}/backgrounds/home-background.jpg`}
      disablepictureinpicture
      webkit-playsinline
      controls={false}
    >
      <source src={`${getImageBaseUrl()}/assets/aboutus.mp4`} type="video/mp4" />
      Your browser does not support the video tag.
    </video>
    <!-- Dark Overlay -->
    <div class="absolute inset-0 z-10 bg-black/70"></div>
  </div>

  <!-- Content Container -->
  <div
    class="relative z-20 flex w-full flex-col items-center px-6 sm:px-8 lg:px-12 py-16 pt-24 md:pt-32"
  >
    <div class="container mx-auto max-w-6xl px-4 w-full">
      <!-- Cards Container -->
      <div class="about-cards relative mx-auto max-w-5xl w-full">
        <!-- Title -->
        <h2
          class="about-title mb-8 text-4xl md:text-5xl font-bold text-white text-center relative z-30"
        >
          About GMC Tourism
        </h2>

        <!-- All Cards Displayed -->
        <div class="flex flex-col gap-6 mb-12">
          <!-- Card 1: Premier Destination -->
          <div class="carousel-card liquid-glass p-8 md:p-12 rounded-2xl text-center">
            <div class="carousel-content flex items-center justify-center">
              <p class="text-lg md:text-xl leading-relaxed font-regular max-w-4xl">
                Gelephu Mindfulness City is emerging as a premier destination for mindful,
                sustainable, and transformative travel. Designed as a place where spirituality,
                wellness, and eco-conscious living come together, GMC offers unique opportunities
                for retreats, eco-tourism, and cultural exchange.

                <br />
                <br />
                GMC’s tourism identity is built on five pillars: nature, adventure, spiritual, wellness,
                and culture, giving visitors a chance to immerse themselves in meaningful and authentic
                journeys. With a new international airport under development and improved road and rail
                connections, GMC is set to welcome travellers from around the world to discover a destination
                where mindfulness, culture, and community shape every experience.
              </p>
            </div>
          </div>

          <!-- Card 2: Five Pillars -->
          <div class="carousel-card liquid-glass p-8 md:p-12 rounded-2xl text-center">
            <div class="carousel-content flex items-center justify-center">
              <p class="text-lg md:text-xl leading-relaxed font-regular max-w-4xl">
                Our mission is to shape Gelephu Mindfulness City into a transformative tourism
                destination that nurtures mind, body, and spirit. Through our tourism pillars, we
                create authentic, regenerative, and immersive experiences that celebrate Bhutanese
                culture, protect the environment, and connect travellers meaningfully with community
                and self.
                <br />
                <br />
                We aspire to establish Gelephu Mindfulness City as the world’s foremost hub for mindful,
                sustainable, and purposeful travel—where people from all walks of life come together
                to explore, heal, and grow, inspired by Bhutan’s values of harmony, resilience, and holistic
                wellbeing.
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Top gradient to hide line from hero section -->
  <div
    class="absolute top-0 left-0 right-0 z-15 h-24 md:h-32"
    style="background: linear-gradient(to bottom, #000000 0%, #000000 40%, rgba(0, 0, 0, 0.8) 70%, transparent 100%);"
  >
  </div>

  <!-- Bottom gradient -->
  <div
    class="absolute bottom-0 left-0 right-0 z-20 h-16"
    style="background: linear-gradient(to top, #000000, transparent);"
  >
  </div>
</section>

<style>
  .about-section {
    position: relative;
  }

  #about-video {
    pointer-events: none;
    transition: transform 0.5s ease-out;
  }

  .about-cards {
    opacity: 0;
    transform: translateY(100px);
    position: relative;
    z-index: 30;
  }

  .about-title {
    color: #ffffff !important;
  }

  :global([data-theme='light']) .about-title {
    color: #ffffff !important;
  }

  .carousel-content {
    /* Flex centering handled in HTML classes */
  }

  .liquid-glass {
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(20px) saturate(180%);
    -webkit-backdrop-filter: blur(20px) saturate(180%);
    border: 1px solid rgba(255, 255, 255, 0.2);
    box-shadow:
      0 8px 32px 0 rgba(0, 0, 0, 0.37),
      inset 0 1px 0 0 rgba(255, 255, 255, 0.3);
    position: relative;
    overflow: hidden;
  }

  .liquid-glass::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 1px;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
  }

  .carousel-card {
    color: #ffffff !important;
  }

  .carousel-card p,
  .carousel-card [data-carousel-text] {
    color: #ffffff !important;
  }

  :global([data-theme='dark']) .carousel-card {
    color: #ffffff !important;
  }

  :global([data-theme='dark']) .carousel-card p,
  :global([data-theme='dark']) .carousel-card [data-carousel-text] {
    color: #ffffff !important;
  }

  :global([data-theme='light']) .carousel-card {
    color: #ffffff !important;
  }

  :global([data-theme='light']) .carousel-card p,
  :global([data-theme='light']) .carousel-card [data-carousel-text] {
    color: #ffffff !important;
  }

  #about-video::-webkit-media-controls {
    display: none !important;
  }

  #about-video::-webkit-media-controls-enclosure {
    display: none !important;
  }

  #about-video::-webkit-media-controls-panel {
    display: none !important;
  }

  #about-video::-webkit-media-controls-play-button {
    display: none !important;
  }

  #about-video::-webkit-media-controls-start-playback-button {
    display: none !important;
  }
</style>

<script>
  // Ensure background video plays
  function initializeAboutVideo() {
    const aboutVideo = document.getElementById('about-video') as HTMLVideoElement | null;
    if (!aboutVideo) {
      console.error('About video element not found');
      return;
    }

    // Force mute
    aboutVideo.muted = true;
    aboutVideo.defaultMuted = true;

    // Set volume to 0 as backup
    aboutVideo.volume = 0;

    // Try to play the video
    const playVideo = () => {
      const playPromise = aboutVideo.play();

      if (playPromise !== undefined) {
        playPromise
          .then(() => {
            console.log('About video is playing');
          })
          .catch((error) => {
            console.log('Video autoplay prevented, will retry on user interaction:', error);

            // Try to play on any user interaction
            const playOnInteraction = () => {
              aboutVideo.play().catch((e) => console.log('Retry failed:', e));
              document.removeEventListener('click', playOnInteraction);
              document.removeEventListener('touchstart', playOnInteraction);
              document.removeEventListener('scroll', playOnInteraction);
            };

            document.addEventListener('click', playOnInteraction, { once: true });
            document.addEventListener('touchstart', playOnInteraction, { once: true });
            document.addEventListener('scroll', playOnInteraction, { once: true });
          });
      }
    };

    // Wait for video to be loaded enough
    if (aboutVideo.readyState >= 3) {
      // Video is already loaded
      playVideo();
    } else {
      aboutVideo.addEventListener('loadeddata', playVideo, { once: true });
      aboutVideo.addEventListener('canplay', playVideo, { once: true });
    }

    // Ensure video continues playing when it's in viewport
    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting && aboutVideo.paused) {
            aboutVideo.play().catch((e) => console.log('IntersectionObserver play failed:', e));
          }
        });
      },
      { threshold: 0.1 }
    );

    observer.observe(aboutVideo);

    // Ensure video doesn't pause
    aboutVideo.addEventListener('pause', () => {
      if (aboutVideo.readyState >= 3) {
        aboutVideo.play().catch((e) => console.log('Resume after pause failed:', e));
      }
    });
  }

  // Initialize when DOM is ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initializeAboutVideo);
  } else {
    initializeAboutVideo();
  }

  // Scroll-triggered animation for About section with bouncy slide-up effect
  function initAboutSectionAnimation() {
    const aboutSection = document.querySelector('.about-section');
    const aboutCards = document.querySelector('.about-cards');

    if (!aboutSection || !aboutCards) return;

    // Import GSAP and ScrollTrigger for animation
    import('gsap').then(({ gsap }) => {
      import('gsap/ScrollTrigger').then(({ ScrollTrigger }) => {
        gsap.registerPlugin(ScrollTrigger);

        // Bouncy slide-up animation with "thak thak" effect
        // Triggers after scrolling 20px from the top of the page
        gsap.fromTo(
          aboutCards,
          {
            opacity: 0,
            y: 150,
          },
          {
            opacity: 1,
            y: 0,
            duration: 1.4,
            ease: 'elastic.out(1, 0.6)',
            scrollTrigger: {
              trigger: 'body',
              start: '20px top', // Triggers after scrolling 20px
              toggleActions: 'play none none none',
              once: true, // Only play once
            },
            onComplete: () => {
              // Add a subtle bounce effect for "thak thak"
              gsap.to(aboutCards, {
                y: -10,
                duration: 0.15,
                ease: 'power2.out',
                yoyo: true,
                repeat: 1,
              });
            },
          }
        );
      });
    });

    // Video parallax effect similar to Hero section
    const aboutVideo = document.getElementById('about-video') as HTMLVideoElement | null;
    if (aboutVideo) {
      window.addEventListener(
        'scroll',
        () => {
          const aboutSectionRect = aboutSection.getBoundingClientRect();
          // Only apply parallax when section is in view
          if (aboutSectionRect.top < window.innerHeight && aboutSectionRect.bottom > 0) {
            const scrollY = window.scrollY;
            const sectionTop = (aboutSection as HTMLElement).offsetTop;
            const parallaxSpeed = 0.15;
            const relativeScroll = scrollY - sectionTop;
            aboutVideo.style.transform = `scale(1.1) translateY(${relativeScroll * parallaxSpeed}px)`;
          }
        },
        { passive: true }
      );
    }
  }

  // Initialize when DOM is ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initAboutSectionAnimation);
  } else {
    initAboutSectionAnimation();
  }
</script>
