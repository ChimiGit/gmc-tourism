---
import ThemeManager from '../ui/ThemeManager.astro';
---

<header id="site-header" class="fixed top-0 left-0 z-50 w-full">
  <!-- Main Navbar -->
  <div
    id="navbar"
    class="flex w-full items-center justify-between px-4 py-2 transition-all duration-300 md:px-12"
  >
    <div id="logo-container" class="relative z-10">
      <a href="/" class="relative block h-10 w-10 md:h-12 md:w-12">
        <img
          id="site-logo"
          src="/logo-light.svg"
          alt="GMC Tourism Logo"
          class="h-full w-full object-contain transition-all duration-300"
        />
      </a>
    </div>

    <div class="relative z-10 flex items-center gap-4">
      <ThemeManager />
      <button
        id="menu-toggle"
        class="cursor-pointer px-4 font-medium uppercase tracking-wider text-white transition-opacity hover:opacity-70"
        aria-label="Toggle menu"
      >
        Menu
      </button>
    </div>
  </div>

  <!-- Menu Overlay -->
  <div
    id="menu-overlay"
    class="pointer-events-none fixed top-0 right-0 z-50 h-full w-full bg-black text-white opacity-0 transition-all duration-300 md:w-1/2 lg:w-1/3"
    style="box-shadow: -10px 0 30px rgba(0,0,0,0.5); transform: translateX(100%);"
  >
    <div class="relative flex h-full flex-col">
      <!-- Background decoration -->
      <div
        id="menu-decoration"
        class="pointer-events-none absolute top-1/2 right-12 flex -translate-y-1/2 flex-col items-center gap-6 select-none"
      >
        <span
          class="text-[15vw] font-bold leading-[0.8] tracking-tight text-white opacity-10 md:text-[12vw] lg:text-[8vw]"
        >
          G
        </span>
        <span
          class="text-[15vw] font-bold leading-[0.8] tracking-tight text-white opacity-10 md:text-[12vw] lg:text-[8vw]"
        >
          M
        </span>
        <span
          class="text-[15vw] font-bold leading-[0.8] tracking-tight text-white opacity-10 md:text-[12vw] lg:text-[8vw]"
        >
          C
        </span>
      </div>

      <!-- Close button -->
      <div class="flex justify-end px-6 py-6 md:px-12">
        <button
          id="menu-close"
          class="text-white transition-opacity hover:opacity-70"
          aria-label="Close menu"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="32"
            height="32"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path d="M18 6 6 18"></path>
            <path d="m6 6 12 12"></path>
          </svg>
        </button>
      </div>

      <!-- Menu Content -->
      <div class="relative flex flex-1 flex-col justify-center px-6 md:px-12">
        <nav id="menu-items" class="space-y-4 md:space-y-6">
          <div class="menu-item overflow-hidden">
            <a
              href="/"
              class="relative block rounded-lg px-3 py-2 text-4xl font-bold text-gray-400 transition-all duration-200 hover:text-white"
            >
              Home
            </a>
          </div>

          <div class="menu-item overflow-hidden">
            <div class="group space-y-2">
              <button
                class="submenu-toggle relative flex items-center gap-3 rounded-lg px-3 py-2 text-left text-4xl font-bold text-gray-400 transition-all duration-200 hover:text-white"
                data-submenu="about"
              >
                About
              </button>
            </div>
          </div>

          <div class="menu-item overflow-hidden">
            <a
              href="/experiences"
              class="relative block rounded-lg px-3 py-2 text-4xl font-bold text-gray-400 transition-all duration-200 hover:text-white"
            >
              Experiences
            </a>
          </div>

          <div class="menu-item overflow-hidden">
            <a
              href="/events"
              class="relative block rounded-lg px-3 py-2 text-4xl font-bold text-gray-400 transition-all duration-200 hover:text-white"
            >
              Events Calendar
            </a>
          </div>

          <div class="menu-item overflow-hidden">
            <a
              href="/gallery"
              class="relative block rounded-lg px-3 py-2 text-4xl font-bold text-gray-400 transition-all duration-200 hover:text-white"
            >
              Gallery
            </a>
          </div>

          <div class="menu-item overflow-hidden">
            <a
              href="/projects-and-partners"
              class="relative block rounded-lg px-3 py-2 text-4xl font-bold text-gray-400 transition-all duration-200 hover:text-white"
            >
              Projects & Partners
            </a>
          </div>

          <div class="menu-item overflow-hidden">
            <a
              href="/contact"
              class="relative block rounded-lg px-3 py-2 text-4xl font-bold text-gray-400 transition-all duration-200 hover:text-white"
            >
              Contact
            </a>
          </div>
        </nav>
      </div>
    </div>
  </div>

  <!-- Overlay backdrop -->
  <div
    id="menu-backdrop"
    class="fixed inset-0 z-40 hidden bg-black/50 transition-opacity duration-300"
    style="cursor: pointer;"
  >
  </div>
</header>

<script>
  let isMenuOpen = false;

  const menuToggle = document.getElementById('menu-toggle');
  const menuClose = document.getElementById('menu-close');
  const menuOverlay = document.getElementById('menu-overlay');
  const menuBackdrop = document.getElementById('menu-backdrop');
  const submenuToggles = document.querySelectorAll('.submenu-toggle');

  function openMenu() {
    isMenuOpen = true;
    if (menuOverlay && menuBackdrop) {
      menuOverlay.classList.remove('pointer-events-none', 'opacity-0');
      menuOverlay.classList.add('pointer-events-auto', 'opacity-100');
      menuOverlay.style.transform = 'translateX(0)';
      menuBackdrop.classList.remove('hidden');
      document.body.style.overflow = 'hidden';

      // Animate menu items
      setTimeout(() => {
        const items = document.querySelectorAll('.menu-item');
        items.forEach((item, i) => {
          setTimeout(() => {
            (item as HTMLElement).style.opacity = '1';
            (item as HTMLElement).style.transform = 'translateX(0)';
          }, i * 80);
        });
      }, 100);
    }
  }

  function closeMenu() {
    isMenuOpen = false;
    if (menuOverlay && menuBackdrop) {
      menuOverlay.classList.add('pointer-events-none', 'opacity-0');
      menuOverlay.classList.remove('pointer-events-auto', 'opacity-100');
      menuOverlay.style.transform = 'translateX(100%)';
      menuBackdrop.classList.add('hidden');
      document.body.style.overflow = 'auto';

      // Reset menu items
      const items = document.querySelectorAll('.menu-item');
      items.forEach((item) => {
        (item as HTMLElement).style.opacity = '0';
        (item as HTMLElement).style.transform = 'translateX(50px)';
      });
    }
  }

  // Toggle menu
  menuToggle?.addEventListener('click', () => {
    if (isMenuOpen) {
      closeMenu();
    } else {
      openMenu();
    }
  });

  menuClose?.addEventListener('click', closeMenu);
  menuBackdrop?.addEventListener('click', closeMenu);

  // Handle submenu toggles
  submenuToggles.forEach((toggle) => {
    toggle.addEventListener('click', (e) => {
      const submenuId = (e.currentTarget as HTMLElement).dataset.submenu;
      const submenuContent = document.querySelector(`[data-submenu-content=\"${submenuId}\"]`);

      if (submenuContent) {
        submenuContent.classList.toggle('hidden');
      }
    });
  });

  // Close menu when clicking on a link
  const menuLinks = document.querySelectorAll('#menu-items a');
  menuLinks.forEach((link) => {
    link.addEventListener('click', closeMenu);
  });

  // Initialize menu items with hidden state
  document.addEventListener('DOMContentLoaded', () => {
    const items = document.querySelectorAll('.menu-item');
    items.forEach((item) => {
      (item as HTMLElement).style.opacity = '0';
      (item as HTMLElement).style.transform = 'translateX(50px)';
      (item as HTMLElement).style.transition = 'opacity 0.5s, transform 0.5s';
    });
  });
</script>
