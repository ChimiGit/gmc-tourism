---
interface DividerProps {
  className?: string;
  width?: string | number;
  height?: string | number;
}

const { className = '', width = '50%', height = '30px' } = Astro.props as DividerProps;

const widthValue = typeof width === 'number' ? `${width}px` : width;
const heightValue = typeof height === 'number' ? `${height}px` : height;
---

<div
  class={`relative my-4 flex w-full justify-center overflow-hidden ${className}`}
  data-divider-container
>
  <div
    style={{
      height: heightValue,
      width: widthValue,
      position: 'relative',
      overflow: 'hidden',
    }}
  >
    <img src="/divider.svg" alt="" class="h-full w-full object-contain" aria-hidden="true" />
  </div>
</div>

<script>
  const currentScript = document.currentScript;
  const dividerContainer = currentScript?.previousElementSibling as HTMLElement | null;
  const dividerImg = dividerContainer?.querySelector('img') as HTMLImageElement | null;

  function updateDivider() {
    if (!dividerImg) return;

    const theme = document.documentElement.getAttribute('data-theme') || 'dark';
    dividerImg.src = theme === 'light' ? '/divider.svg' : '/divider-light.svg';
  }

  // Wait for DOM to be ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', () => {
      updateDivider();

      // Watch for theme changes
      const observer = new MutationObserver(() => {
        updateDivider();
      });

      observer.observe(document.documentElement, {
        attributes: true,
        attributeFilter: ['data-theme'],
      });
    });
  } else {
    // DOM is already ready
    updateDivider();

    // Watch for theme changes
    const observer = new MutationObserver(() => {
      updateDivider();
    });

    observer.observe(document.documentElement, {
      attributes: true,
      attributeFilter: ['data-theme'],
    });
  }
</script>
