---
interface DividerProps {
  className?: string;
  width?: string | number;
  height?: string | number;
}

const { className = '', width = '50%', height = '30px' } = Astro.props as DividerProps;

const widthValue = typeof width === 'number' ? `${width}px` : width;
const heightValue = typeof height === 'number' ? `${height}px` : height;
---

<div
  class={`relative my-4 flex w-full justify-center overflow-hidden ${className}`}
  data-divider-container
>
  <div
    style={{
      height: heightValue,
      width: widthValue,
      position: 'relative',
      overflow: 'hidden',
    }}
  >
    <img
      src="/divider-light.svg"
      alt=""
      class="h-full w-full object-contain"
      aria-hidden="true"
      data-divider-img
    />
  </div>
</div>

<script is:inline>
  (function () {
    function initDivider() {
      // Find all divider images on the page
      const dividerImages = document.querySelectorAll('[data-divider-img]');

      function updateDivider(img) {
        const theme = document.documentElement.getAttribute('data-theme') || 'dark';
        // Light mode: divider.svg, Dark mode: divider-light.svg
        img.src = theme === 'light' ? '/divider.svg' : '/divider-light.svg';
      }

      // Update all divider images
      dividerImages.forEach((img) => {
        updateDivider(img);
      });

      // Listen for theme change events from ThemeManager
      window.addEventListener('themechange', (e) => {
        dividerImages.forEach((img) => {
          img.src = e.detail.theme === 'light' ? '/divider.svg' : '/divider-light.svg';
        });
      });

      // Also watch for data-theme attribute changes as a fallback
      const observer = new MutationObserver(() => {
        dividerImages.forEach((img) => {
          updateDivider(img);
        });
      });

      observer.observe(document.documentElement, {
        attributes: true,
        attributeFilter: ['data-theme'],
      });
    }

    // Initialize when DOM is ready
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initDivider);
    } else {
      // DOM is already ready, but wait a bit for ThemeManager to initialize
      setTimeout(initDivider, 0);
    }
  })();
</script>
