---
interface Props {
  className?: string;
}

const { className = '' } = Astro.props;
---

<div
  class={`animated-logo-container relative flex h-full w-full items-center justify-center ${className}`}
  data-animated-logo
>
  <svg
    id="animated-logo-svg"
    width="300"
    height="300"
    viewBox="0 0 342 343"
    fill="none"
    xmlns="http://www.w3.org/2000/svg"
    class="h-full w-full max-w-lg transition-all duration-300"
  >
    <path
      d="M204.768 95.8232L178.467 122.134"
      stroke="white"
      stroke-width="10"
      stroke-miterlimit="10"></path>
    <path
      d="M233.225 67.3545L220.158 80.4314"
      stroke="white"
      stroke-width="10"
      stroke-miterlimit="10"></path>
    <path
      d="M129.546 171.073L88.0742 129.586"
      stroke="white"
      stroke-width="10"
      stroke-miterlimit="10"></path>
    <path
      d="M88.0781 88.0928L171.012 171.072"
      stroke="white"
      stroke-width="10"
      stroke-miterlimit="10"></path>
    <path
      d="M183.953 101.029L129.545 46.6064"
      stroke="white"
      stroke-width="10"
      stroke-miterlimit="10"></path>
    <path
      d="M225.426 142.521L199.355 116.436"
      stroke="white"
      stroke-width="10"
      stroke-miterlimit="10"></path>
    <path
      d="M253.966 171.073L240.773 157.875"
      stroke="white"
      stroke-width="10"
      stroke-miterlimit="10"></path>
    <path d="M129.545 46.6064H182.127" stroke="white" stroke-width="10" stroke-miterlimit="10"
    ></path>
    <path d="M46.6016 129.58H159.897" stroke="white" stroke-width="10" stroke-miterlimit="10"
    ></path>
    <path
      d="M203.767 55.3379L171.857 87.2587"
      stroke="white"
      stroke-width="10"
      stroke-miterlimit="10"></path>
    <path
      d="M316.165 150.324L303.072 163.422"
      stroke="white"
      stroke-width="10"
      stroke-miterlimit="10"></path>
    <path
      d="M183.922 142.484L129.551 88.0928"
      stroke="white"
      stroke-width="10"
      stroke-miterlimit="10"></path>
    <path
      d="M212.49 171.067L199.303 157.875"
      stroke="white"
      stroke-width="10"
      stroke-miterlimit="10"></path>
    <path
      d="M88.0737 171.067L46.6016 129.58"
      stroke="white"
      stroke-width="10"
      stroke-miterlimit="10"></path>
    <path
      d="M5.15039 5.11914L88.0789 88.0933"
      stroke="white"
      stroke-width="10"
      stroke-miterlimit="10"></path>
    <path
      d="M286.679 138.333L261.615 163.411"
      stroke="white"
      stroke-width="10"
      stroke-miterlimit="10"></path>
    <path
      d="M88.0742 171.067L88.0847 5.11914"
      stroke="white"
      stroke-width="10"
      stroke-miterlimit="10"></path>
    <path
      d="M225.426 101.029L199.355 74.9482"
      stroke="white"
      stroke-width="10"
      stroke-miterlimit="10"></path>
    <path
      d="M266.865 142.484L240.789 116.403"
      stroke="white"
      stroke-width="10"
      stroke-miterlimit="10"></path>
    <path
      d="M295.434 171.067L282.23 157.859"
      stroke="white"
      stroke-width="10"
      stroke-miterlimit="10"></path>
    <path d="M204.779 137.3L171.018 171.068" stroke="white" stroke-width="10" stroke-miterlimit="10"
    ></path>
    <path
      d="M245.238 96.8203L220.158 121.914"
      stroke="white"
      stroke-width="10"
      stroke-miterlimit="10"></path>
    <path d="M336.9 5.11914L253.961 88.0985" stroke="white" stroke-width="10" stroke-miterlimit="10"
    ></path>
    <path
      d="M171.013 88.0984L5.13477 88.0879"
      stroke="white"
      stroke-width="10"
      stroke-miterlimit="10"></path>
    <path
      d="M246.203 137.336L220.158 163.395"
      stroke="white"
      stroke-width="10"
      stroke-miterlimit="10"></path>
    <path
      d="M274.693 108.837L261.615 121.924"
      stroke="white"
      stroke-width="10"
      stroke-miterlimit="10"></path>
    <path d="M88.0742 254.047V337.021" stroke="white" stroke-width="10" stroke-miterlimit="10"
    ></path>
    <path
      d="M253.961 337.021V254.047H336.9L253.961 337.021Z"
      stroke="white"
      stroke-width="10"
      stroke-linejoin="bevel"></path>
    <path d="M88.0731 254.047H5.12891" stroke="white" stroke-width="10" stroke-miterlimit="10"
    ></path>
    <path d="M253.956 254.047H171.012" stroke="white" stroke-width="10" stroke-miterlimit="10"
    ></path>
    <path
      d="M171.015 5.12223L5.13086 171.066L171.019 337.014L336.903 171.07L171.015 5.12223Z"
      stroke="white"
      stroke-width="10"
      stroke-linejoin="bevel"></path>
    <path d="M212.484 171.067V295.534" stroke="white" stroke-width="10" stroke-miterlimit="10"
    ></path>
    <path d="M253.957 171.067V254.047" stroke="white" stroke-width="10" stroke-miterlimit="10"
    ></path>
    <path d="M295.428 171.067V212.56" stroke="white" stroke-width="10" stroke-miterlimit="10"
    ></path>
    <path
      d="M171.008 5.11914C185.832 32.7789 185.832 60.4335 171.008 88.0933C156.189 115.753 156.189 143.413 171.008 171.067H170.997C185.821 198.727 185.821 226.382 170.997 254.041C156.178 281.701 156.178 309.361 170.997 337.016"
      stroke="white"
      stroke-width="10"
      stroke-miterlimit="10"></path>
    <path
      d="M336.901 171.067L5.13477 171.073"
      stroke="white"
      stroke-width="10"
      stroke-miterlimit="10"></path>
    <path d="M140.168 254.047H170.997" stroke="white" stroke-width="10" stroke-linejoin="bevel"
    ></path>
    <path d="M88.0527 254.047H118.567" stroke="white" stroke-width="10" stroke-linejoin="bevel"
    ></path>
    <path d="M88.0527 182.696V254.047" stroke="white" stroke-width="10" stroke-linejoin="bevel"
    ></path>
    <path d="M129.529 223.364V295.534" stroke="white" stroke-width="10" stroke-miterlimit="10"
    ></path>
    <path d="M129.529 46.6006V201.755" stroke="white" stroke-width="10" stroke-miterlimit="10"
    ></path>
    <path d="M129.529 295.534H212.463" stroke="white" stroke-width="10" stroke-miterlimit="10"
    ></path>
    <path d="M46.5801 212.56V129.591" stroke="white" stroke-width="10" stroke-miterlimit="10"
    ></path>
    <path
      d="M98.8574 212.555L295.412 212.56"
      stroke="white"
      stroke-width="10"
      stroke-miterlimit="10"></path>
    <path d="M46.5859 212.555H77.2573" stroke="white" stroke-width="10" stroke-miterlimit="10"
    ></path>
    <path
      d="M336.9 341V5.11914H5.11328V337.021H336.9V342"
      stroke="white"
      stroke-width="10"
      stroke-miterlimit="10"></path>
  </svg>
</div>

<script>
  import { gsap } from 'gsap';

  function initAnimatedLogo() {
    const container = document.querySelector('[data-animated-logo]');
    const svg = document.getElementById('animated-logo-svg');

    if (!svg || !container) return;

    // Get all paths
    const paths = svg.querySelectorAll('path');
    const pathsArray = Array.from(paths) as SVGPathElement[];

    // Reset any previous animations
    gsap.killTweensOf(paths);
    gsap.killTweensOf(svg);

    // Define the center point of the SVG
    const centerX = 171;
    const centerY = 171;

    // Group paths by their position relative to the center
    const topLeftPaths: SVGPathElement[] = [];
    const topRightPaths: SVGPathElement[] = [];
    const bottomLeftPaths: SVGPathElement[] = [];
    const bottomRightPaths: SVGPathElement[] = [];
    const centerPaths: SVGPathElement[] = [];

    // Categorize paths based on their bounding box position
    pathsArray.forEach((path) => {
      // Get the bounding box of the path
      const bbox = path.getBBox();
      const pathCenterX = bbox.x + bbox.width / 2;
      const pathCenterY = bbox.y + bbox.height / 2;

      // Calculate distance from center (for sorting later)
      const distanceFromCenter = Math.sqrt(
        Math.pow(pathCenterX - centerX, 2) + Math.pow(pathCenterY - centerY, 2)
      );

      // Store distance for sorting
      path.dataset.distance = distanceFromCenter.toString();

      // Determine which quadrant the path belongs to
      if (Math.abs(pathCenterX - centerX) < 40 && Math.abs(pathCenterY - centerY) < 40) {
        centerPaths.push(path); // Center paths
      } else if (pathCenterX <= centerX && pathCenterY <= centerY) {
        topLeftPaths.push(path); // Top-left quadrant
      } else if (pathCenterX > centerX && pathCenterY <= centerY) {
        topRightPaths.push(path); // Top-right quadrant
      } else if (pathCenterX <= centerX && pathCenterY > centerY) {
        bottomLeftPaths.push(path); // Bottom-left quadrant
      } else {
        bottomRightPaths.push(path); // Bottom-right quadrant
      }
    });

    // Sort each quadrant's paths by distance from center (outside to inside)
    const sortByDistance = (a: SVGPathElement, b: SVGPathElement): number => {
      return (
        Number.parseFloat(b.dataset.distance || '0') - Number.parseFloat(a.dataset.distance || '0')
      );
    };

    topLeftPaths.sort(sortByDistance);
    topRightPaths.sort(sortByDistance);
    bottomLeftPaths.sort(sortByDistance);
    bottomRightPaths.sort(sortByDistance);
    centerPaths.sort(sortByDistance);

    // Set initial state for all paths
    gsap.set(
      [...topLeftPaths, ...topRightPaths, ...bottomLeftPaths, ...bottomRightPaths, ...centerPaths],
      {
        strokeDasharray: (index, target) => {
          const length = (target as SVGPathElement).getTotalLength
            ? (target as SVGPathElement).getTotalLength()
            : 100;
          return `${length} ${length}`;
        },
        strokeDashoffset: (index, target) =>
          (target as SVGPathElement).getTotalLength
            ? (target as SVGPathElement).getTotalLength()
            : 100,
        opacity: 0,
        scale: 0.8,
        transformOrigin: 'center center',
      }
    );

    let isAnimationComplete = false;

    // Create the main animation timeline
    const mainTimeline = gsap.timeline({
      defaults: { ease: 'power2.inOut' },
      onComplete: () => {
        isAnimationComplete = true;
        container?.classList.add('animation-complete');
        // Dispatch custom event when animation completes
        window.dispatchEvent(new Event('animationComplete'));
      },
    });

    // Helper function to create corner animations
    interface AnimateCornerParams {
      paths: SVGPathElement[];
      delay: number;
      xOffset: number;
      yOffset: number;
    }

    const animateCorner = ({ paths, delay, xOffset, yOffset }: AnimateCornerParams): void => {
      // Create a timeline for this corner
      const cornerTl = gsap.timeline();

      // Add initial transform for each path to make them start from outside
      gsap.set(paths, {
        x: xOffset,
        y: yOffset,
      });

      // Animate the paths
      cornerTl.to(paths, {
        strokeDashoffset: 0,
        opacity: 1,
        scale: 1,
        x: 0,
        y: 0,
        duration: 1.4,
        stagger: {
          each: 0.03,
          from: 'start', // Start from the outside
        },
      });

      // Add the corner timeline to the main timeline
      mainTimeline.add(cornerTl, delay);
    };

    // Animate from each corner with offsets
    animateCorner({
      paths: topLeftPaths,
      delay: 0,
      xOffset: -20,
      yOffset: -20,
    });
    animateCorner({
      paths: topRightPaths,
      delay: 0.2,
      xOffset: 20,
      yOffset: -20,
    });
    animateCorner({
      paths: bottomLeftPaths,
      delay: 0.4,
      xOffset: -20,
      yOffset: 20,
    });
    animateCorner({
      paths: bottomRightPaths,
      delay: 0.6,
      xOffset: 20,
      yOffset: 20,
    });

    // Animate center paths with a special emphasis
    mainTimeline.to(
      centerPaths,
      {
        strokeDashoffset: 0,
        opacity: 1,
        scale: 1,
        duration: 1.5,
        stagger: 0.05,
      },
      '-=0.8' // Overlap with the corner animations
    );

    // Add a glow effect as the animation completes
    mainTimeline.to(
      svg,
      {
        filter: 'drop-shadow(0 0 10px rgba(255, 255, 255, 0.7))',
        duration: 0.8,
      },
      '-=0.5'
    );

    // Add a slight pulse at the end to emphasize completion
    mainTimeline.to(
      svg,
      {
        scale: 1.05,
        duration: 0.5,
        yoyo: true,
        repeat: 1,
        ease: 'power1.inOut',
      },
      '+=0.1'
    );

    // Return to normal state with a subtle glow
    mainTimeline.to(svg, {
      filter: 'drop-shadow(0 0 5px rgba(255, 255, 255, 0.3))',
      duration: 0.5,
    });

    // Add hover effect after animation completes
    container?.addEventListener('mouseenter', () => {
      if (isAnimationComplete) {
        gsap.to(svg, {
          scale: 1.05,
          duration: 0.3,
          ease: 'power2.out',
        });
      }
    });

    container?.addEventListener('mouseleave', () => {
      if (isAnimationComplete) {
        gsap.to(svg, {
          scale: 1,
          duration: 0.3,
          ease: 'power2.out',
        });
      }
    });
  }

  // Initialize when DOM is ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initAnimatedLogo);
  } else {
    initAnimatedLogo();
  }
</script>

<style>
  .animated-logo-container.animation-complete {
    transition: all 0.3s;
  }

  .animated-logo-container.animation-complete:hover {
    transform: scale(1.05);
  }
</style>
